name: ubiquia-workbench
modelType: Graph
author: Jeremy Case
description: A DAG that ships with Ubiquia that can be used to generate new ACLs and DAGs

version:
  major: 2
  minor: 0
  patch: 0

tags:

capabilities:
 - AclGeneration
 - DagGeneration

agentCommunicationLanguage:
  name: ubiquia-workbench
  version:
    major: 1
    minor: 1
    patch: 0

components:

  - name: Workbench-Whisperer

    componentType: POD
    modelType: Component
    description: This component contains several endpoints that can be used to interface successfully with the Workbench LLM.

    port: 8080

    image:
      registry: ubiquia
      repository: dag-workbench-whisperer
      tag: latest

    overrideSettings:

  - name: Workbench-LLM

    componentType: POD
    modelType: Component
    description: An LLM for our workbench.

    port: 11434

    image:
      registry: ollama
      repository: ollama
      tag: 0.11.5

    overrideSettings:

    postStartExecCommands:
      - /bin/sh
      - -c
      - |
        set -eu
        echo "Waiting for Ollama..."
        i=0
        while [ "$i" -lt 360 ]; do
          if ollama list >/dev/null 2>&1; then
            echo "Daemon up. Pulling model..."
            ollama pull llama3.2
            exit 0
          fi
          i=$((i+1))
          sleep 1
        done
        echo "Ollama not ready after 360s" >&2
        exit 1

componentlessAdapters:

  - modelType: Adapter
    adapterType: PUSH
    name: Workbench-User-Prompt-Adapter
    description: SENPAI!

    communicationServiceSettings:
      exposeViaCommService: true

    endpoint: http://workbench-whisperer:8080/generate-dag-input

    inputSubSchemas:
      - modelName: UserPrompt

    outputSubSchema:
      modelName: LlamaInput
    
    adapterSettings:
      persistInputPayload: true
      persistOutputPayload: true
      validateOutputPayload: true
      validateInputPayload: true
      stimulateInputPayload: false

  - modelType: Adapter
    adapterType: HIDDEN
    name: Dag-Generator-Adapter
    description: An adapter that forwards traffic to our LLM

    endpoint: http://workbench-llm:11434/api/generate

    inputSubSchemas:
      - modelName: LlamaInput

    outputSubSchema:
      modelName: LlamaOutput
    
    adapterSettings:
      persistInputPayload: true
      persistOutputPayload: true
      validateOutputPayload: false
      validateInputPayload: false
      stimulateInputPayload: false

  - modelType: Adapter
    adapterType: HIDDEN
    name: Dag-Visualizer-Adapter
    description: An adapter that forwards traffic to our LLM

    endpoint: http://workbench-whisperer:8080/visualize-dag

    inputSubSchemas:
      - modelName: LlamaOutput

    outputSubSchema:
      modelName: LlamaInput
    
    adapterSettings:
      persistInputPayload: true
      persistOutputPayload: true
      validateOutputPayload: false
      validateInputPayload: false
      stimulateInputPayload: false

  - modelType: Adapter
    adapterType: HIDDEN
    name: Dag-Visualization-Generation-Adapter
    description: An adapter that forwards traffic to our LLM

    endpoint: http://workbench-llm:11434/api/generate

    inputSubSchemas:
      - modelName: LlamaInput

    outputSubSchema:
      modelName: LlamaOutput
    
    adapterSettings:
      persistInputPayload: true
      persistOutputPayload: true
      validateOutputPayload: false
      validateInputPayload: false
      stimulateInputPayload: false

edges:
  - leftAdapterName: Workbench-User-Prompt-Adapter
    rightAdapterNames:
      - Dag-Generator-Adapter
  - leftAdapterName: Dag-Generator-Adapter
    rightAdapterNames:
      - Dag-Visualizer-Adapter
  - leftAdapterName: Dag-Visualizer-Adapter
    rightAdapterNames:
      - Dag-Visualization-Generation-Adapter