name: ubiquia-workbench
modelType: Graph
author: Jeremy Case
description: A DAG that ships with Ubiquia that can be used to generate new ACLs and DAGs

# Graphs require semantic versions
version:
  major: 1
  minor: 0
  patch: 0

tags:

capabilities:
 - AclGeneration
 - DagGeneration

agentCommunicationLanguage:
  name: ubiquia-workbench
  version:
    major: 1
    minor: 0
    patch: 0

components:

  - name: Workbench-UI

    componentType: POD
    modelType: Component
    description: This UI will allow clients to prompt Ubiquia to generate new ACLs and DAGs for those problem domains.

    communicationServiceSettings:
      exposeViaCommService: true
      proxiedEndpoint: /index.html

    port: 8080

    image:
      registry: ubiquia
      repository: dag-workbench-ui
      tag: latest

    overrideSettings:

  - name: Workbench-Ollama-Whisperer

    componentType: POD
    modelType: Component
    description: This UI will allow clients to prompt Ubiquia to generate new ACLs and DAGs for those problem domains.

    port: 8080

    image:
      registry: ubiquia
      repository: dag-workbench-ollama-whisperer
      tag: latest

    adapter:
      modelType: Adapter
      adapterType: PUSH
      name: Workbench-Ollama-Whisperer-Adapter
      description: SENPAI!

      communicationServiceSettings:
        exposeViaCommService: true

      endpoint: /wrap

      inputSubSchemas:
        - modelName: UserPrompt

      outputSubSchema:
        modelName: LlamaInput
      
      adapterSettings:
        persistInputPayload: true
        persistOutputPayload: true
        validateOutputPayload: true
        validateInputPayload: true
        stimulateInputPayload: false

    overrideSettings:

  - name: Workbench-ACL-Generator

    componentType: POD
    modelType: Component
    description: An LLM to generate Agent Communication Languages from

    port: 8080

    image:
      registry: ollama
      repository: ollama
      tag: 0.11.5

    overrideSettings:

    postStartExecCommands:
      - /bin/sh
      - -c
      - |
        set -eu
        echo "Waiting for Ollama..."
        i=0
        while [ "$i" -lt 180 ]; do
          if ollama list >/dev/null 2>&1; then
            echo "Daemon up. Pulling model..."
            ollama pull llama3.2
            exit 0
          fi
          i=$((i+1))
          sleep 1
        done
        echo "Ollama not ready after 180s" >&2
        exit 1

    adapter:
      modelType: Adapter
      adapterType: HIDDEN
      name: Workbench-ACL-Generator-Adapter
      description: SENPAI!

      endpoint: /api/generate

      inputSubSchemas:
        - modelName: LlamaInput

      outputSubSchema:
        modelName: LlamaInput
      
      adapterSettings:
        persistInputPayload: true
        persistOutputPayload: true
        validateOutputPayload: false
        validateInputPayload: true
        stimulateInputPayload: false

componentlessAdapters:

edges:
  - leftAdapterName: Workbench-Ollama-Whisperer-Adapter
    rightAdapterNames:
      - Workbench-ACL-Generator-Adapter